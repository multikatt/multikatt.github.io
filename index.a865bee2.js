class t{constructor(t,o){this.pos=t,this.color=o,this.size=20,this.margin=2}}class o{constructor(t=[]){this.occupied_blocks=t}add_to_occupied_blocks(t){t.blocks.forEach((t=>{this.occupied_blocks.push(t)}))}}var s={I:{shape:[[0,0,0,0],[1,1,1,1],[0,0,0,0],[0,0,0,0]],color:"#0DDCE5"},J:{shape:[[1,0,0,0],[1,1,1,0],[0,0,0,0]],color:"#1F77F7"},L:{shape:[[0,0,1,0],[1,1,1,0],[0,0,0,0]],color:"#E9800F"},O:{shape:[[1,1],[1,1]],color:"#F9EC23"},S:{shape:[[0,1,1,0],[1,1,0,0],[0,0,0,0]],color:"#01D705"},T:{shape:[[0,1,0,0],[1,1,1,0],[0,0,0,0]],color:"#FC59FE"},Z:{shape:[[1,1,0,0],[0,1,1,0],[0,0,0,0]],color:"#E83B40"}};class i{get_random_tetro(){let t=["I","J","L","O","S","T","Z"];return t[Math.floor(Math.random()*t.length)]}constructor(t){this.pos_x=4,this.pos_y=1,t||(t=this.get_random_tetro()),this.shape=s[t].shape,this.color=s[t].color}update_tetromino(){this.blocks=[],this.shape.forEach(((o,s)=>{o.forEach(((o,i)=>{1===o&&this.blocks.push(new t({x:this.pos_x+i,y:this.pos_y+s},this.color))}))}))}move(t){"left"==t&&(this.pos_x-=1),"right"==t&&(this.pos_x+=1),"down"==t&&(this.pos_y+=1),this.update_tetromino()}rotate(t="right"){"left"==t&&(this.shape=this.shape.map(((t,o,s)=>s.map((t=>t[o])))).reverse()),"right"==t&&(this.shape=this.shape.reverse().map(((t,o,s)=>s.map((t=>t[o]))))),this.update_tetromino()}}(new class{constructor(){this.speed=250,this.size={w:12,h:22},this.game_state="running",this.update=t=>{if(t-this.prev_time>this.speed){if(this.prev_time=t,this.check_collision("down"))this.board.active_tetromino.move("down");else if(1===this.board.active_tetromino.pos_y)this.game_state="stopped";else{this.contains_full_rows()||this.board.add_to_occupied_blocks(this.board.active_tetromino);const t=new i;t.update_tetromino(),this.board.active_tetromino=t}this.draw_game()}"running"===this.game_state&&window.requestAnimationFrame(this.update)},this.canvas=document.getElementById("Game"),this.ctx=this.canvas.getContext("2d"),this.prev_time=0,this.border_blocks=[],this.create_border(this.size.w,this.size.h),this.board=new o}start(){window.requestAnimationFrame(this.update);const t=new i;t.update_tetromino(),this.board.active_tetromino=t,this.draw_game(),this.input()}create_border(o,s){for(let i=0;i<o;i++)for(let e=0;e<s;e++)0!=e&&e!=s-1&&0!=i&&i!=o-1||this.border_blocks.push(new t({x:i,y:e},"grey"))}contains_full_rows(){let t=[];return this.board.active_tetromino.blocks.filter(((t,o,s)=>s.map((t=>t.pos.y)).indexOf(t.pos.y)==o)).forEach((o=>{let s=this.board.active_tetromino.blocks.filter((t=>t.pos.y===o.pos.y)),i=this.board.occupied_blocks.filter((t=>t.pos.y==o.pos.y));s.length+i.length==this.size.w-2&&t.push(o.pos.y)})),t.length>0&&(this.board.add_to_occupied_blocks(this.board.active_tetromino),t.forEach((t=>{this.board.occupied_blocks=this.board.occupied_blocks.filter((o=>o.pos.y!=t)),this.board.occupied_blocks.filter((o=>o.pos.y<t)).forEach((t=>t.pos.y+=1))})),!0)}check_collision(t){let o=this.board.active_tetromino,s=!0,i=t=>(t.y>=this.size.h-2?s=!1:this.board.occupied_blocks.forEach((o=>{o.pos.x==t.x&&o.pos.y==t.y+1&&(s=!1)})),s),e=(t,o)=>("left"==o?t.x<=1&&(s=!1):"right"==o&&t.x>=this.size.w-2&&(s=!1),this.board.occupied_blocks.forEach((i=>{"left"==o?i.pos.y==t.y&&i.pos.x==t.x-1&&(s=!1):"right"==o&&i.pos.y==t.y&&i.pos.x==t.x+1&&(s=!1)})),s);return o.shape.forEach(((r,h)=>{r.forEach(((r,a)=>{if(1===r){let r={x:a+o.pos_x,y:h+o.pos_y};("left"!=t||e(r,"left"))&&("right"!=t||e(r,"right"))&&("down"!=t||i(r))||(s=!1)}}))})),s}draw_game(){this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.border_blocks.forEach((t=>this.draw_block(t))),this.draw_tetrominos()}draw_tetrominos(){this.board.active_tetromino.blocks.forEach((t=>this.draw_block(t))),this.board.occupied_blocks.forEach((t=>this.draw_block(t)))}draw_block(t){this.ctx.fillStyle=t.color,this.ctx.fillRect(t.pos.x*(t.size+t.margin),t.pos.y*(t.size+t.margin),t.size,t.size)}input(){window.addEventListener("keyup",(t=>{if("running"==this.game_state)switch(t.code){case"ArrowLeft":this.check_collision("left")&&this.board.active_tetromino.move("left"),this.draw_game();break;case"ArrowRight":this.check_collision("right")&&this.board.active_tetromino.move("right"),this.draw_game();break;case"Space":case"ArrowUp":this.board.active_tetromino.rotate("right"),this.draw_game();break;case"ArrowDown":for(;this.check_collision("down");)this.board.active_tetromino.move("down");this.draw_game()}}))}}).start();
//# sourceMappingURL=index.a865bee2.js.map
